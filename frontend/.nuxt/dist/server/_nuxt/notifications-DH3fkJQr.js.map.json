{"file":"notifications-DH3fkJQr.js","mappings":";;;;;;;;;;;;;;;;;;;;;;AAsDA,UAAM,EAAE,KAAA,IAAS,WAAA;AACjB,UAAM,gBAAgB,IAAoB,EAAE;AAC5C,UAAM,UAAU,IAAI,IAAI;AACxB,UAAM,QAAQ,IAAmB,IAAI;;AAxD9B,YAAA,OAAAA,eAAAC,WAAA,EAAA,OAAM,2BAAuB,MAAA,CAAA,CAAA,gDAAA;UAErB,QAAA,OAAO;;iBACF,MAAA,OAAK;;MACL,WAAA,cAAA,MAAc,WAAM,GAAA;;;;AAENC,sBAAA,cAAA,QAAhB,iBAAY;+BAEuBC,eAAA,CAAA,EAAA,gCAAA,aAAa,WAAO,2CAAA,CAAA,gCAGpD,aAAa,OAAO,YAAY,aAAa,OAAO,QAAQ,yCAE5D,aAAa,KAAK,KAAK,oFAGW,aAAa,QAAQ,IAAI,qCACpCC,eAAA,IAAA,KAAK,aAAa,UAAU,EAAE,eAAA,CAAc;;;;;;;;;;;;;;","names":["_ssrRenderAttrs","_mergeProps","_ssrRenderList","_ssrRenderClass","_ssrInterpolate"],"sources":["../../../../pages/notifications.vue"],"sourcesContent":["<template>\n  <div class=\"container mx-auto p-4\">\n    <h1 class=\"text-2xl font-bold mb-4\">消息中心</h1>\n    <div v-if=\"loading\" class=\"text-center\">加载中...</div>\n    <div v-else-if=\"error\" class=\"text-center text-red-500\">加载失败</div>\n    <div v-else-if=\"notifications.length === 0\" class=\"text-center text-gray-500\">暂无消息</div>\n    <div v-else>\n      <div v-for=\"notification in notifications\" :key=\"notification.id\"\n           class=\"p-4 mb-4 border rounded-lg cursor-pointer\"\n           :class=\"{ 'bg-gray-100 dark:bg-gray-800': notification.is_read }\"\n           @click=\"handleNotificationClick(notification)\">\n        <p>\n          <strong>{{ notification.sender.nickname || notification.sender.username }}</strong>\n          在帖子\n          <strong>{{ notification.post.title }}</strong>\n          中回复了你:\n        </p>\n        <p class=\"text-gray-600 dark:text-gray-300\">{{ notification.comment.body }}</p>\n        <small class=\"text-gray-400\">{{ new Date(notification.created_at).toLocaleString() }}</small>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue'\n\ninterface Sender {\n  id: number\n  username: string\n  nickname: string | null\n  avatar_url: string | null\n}\n\ninterface Post {\n  id: number\n  title: string\n}\n\ninterface Comment {\n  id: number\n  body: string\n}\n\ninterface Notification {\n  id: number\n  sender: Sender\n  notification_type: string\n  post: Post\n  comment: Comment\n  is_read: boolean\n  created_at: string\n}\n\nconst { $api } = useNuxtApp()\nconst notifications = ref<Notification[]>([])\nconst loading = ref(true)\nconst error = ref<string | null>(null)\n\nconst fetchNotifications = async () => {\n  try {\n    const response = await $api.get('/notifications/')\n    notifications.value = response.data.results\n  } catch (e) {\n    error.value = 'Failed to load notifications.'\n    console.error(e)\n  } finally {\n    loading.value = false\n  }\n}\n\nconst handleNotificationClick = async (notification: Notification) => {\n  if (!notification.is_read) {\n    try {\n      await $api.post(`/notifications/${notification.id}/mark-as-read/`)\n      notification.is_read = true\n    } catch (e) {\n      console.error('Failed to mark notification as read', e)\n    }\n  }\n  navigateTo(`/community/posts/${notification.post.id}#comment-${notification.comment.id}`)\n}\n\nonMounted(fetchNotifications)\n</script>\n"],"version":3}