{"file":"useStatsSync-DwhmJN9P.js","mappings":";;AAiCO,MAAM,eAAe,MAAM;AAChC,QAAM,EAAE,KAAA,IAAS,WAAA;AACjB,QAAM,YAAY,SAAgC,kBAAkB,MAAM,IAAI;AAC9E,QAAM,YAAY,SAAsC,kBAAkB,MAAM,IAAI;AACpF,QAAM,UAAU,SAAS,qBAAqB,MAAM,KAAK;AAEzD,QAAM,mBAAmB,YAAY;AACnC,UAAM,EAAE,KAAA,IAAwC,MAAM,KAAK,IAAI,eAAe;AAC9E,cAAU,QAAQ;AAClB,WAAO;AAAA,EACT;AAEA,QAAM,mBAAmB,YAAY;AACnC,UAAM,WAA6C,MAAM,KAAK,IAAI,cAAc;AAChF,UAAM,UAAU;AAAA,MACd,aAAa,SAAS,KAAK,eAAe,CAAA;AAAA,MAC1C,iBAAiB,SAAS,KAAK,mBAAmB,CAAA;AAAA,MAClD,gBAAgB,SAAS,KAAK,kBAAkB;AAAA,MAChD,eAAe,SAAS,KAAK,iBAAiB;AAAA,MAC9C,YAAY,SAAS,KAAK,cAAc;AAAA,IAAA;AAE1C,cAAU,QAAQ;AAClB,WAAO;AAAA,EACT;AAEA,QAAM,kBAAkB,YAAY;AAClC,YAAQ,QAAQ;AAChB,QAAI;AACF,YAAM,CAAC,MAAM,IAAI,IAAI,MAAM,QAAQ,IAAI,CAAC,iBAAA,GAAoB,iBAAA,CAAkB,CAAC;AAC/E,aAAO,EAAE,MAAM,KAAA;AAAA,IACjB,UAAA;AACE,cAAQ,QAAQ;AAAA,IAClB;AAAA,EACF;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;","names":[],"sources":["../../../../composables/useStatsSync.ts"],"sourcesContent":["import type { AxiosResponse } from 'axios'\n\nexport type DashboardStats = {\n  quiz_attempts_count: number\n  average_score: number\n  best_score: number\n  last_attempt?: {\n    score: number\n    level: string\n    created_at: string\n  } | null\n}\n\nexport type QuizPerformanceStats = {\n  total_attempts: number\n  average_score: number\n  best_score: number\n  level_stats: Record<string, { attempts: number; average_score: number; best_score: number }>\n  recent_attempts: Array<{\n    id: number\n    level: string\n    score: number\n    total_questions: number\n    correct_answers: number\n    created_at: string\n  }>\n}\n\ntype QuizStatsResponse = Partial<QuizPerformanceStats> & {\n  recent_attempts?: QuizPerformanceStats['recent_attempts']\n  level_stats?: QuizPerformanceStats['level_stats']\n}\n\nexport const useStatsSync = () => {\n  const { $api } = useNuxtApp()\n  const userStats = useState<DashboardStats | null>('mvp-user-stats', () => null)\n  const quizStats = useState<QuizPerformanceStats | null>('mvp-quiz-stats', () => null)\n  const syncing = useState('mvp-stats-syncing', () => false)\n\n  const refreshUserStats = async () => {\n    const { data }: AxiosResponse<DashboardStats> = await $api.get('/users/stats/')\n    userStats.value = data\n    return data\n  }\n\n  const refreshQuizStats = async () => {\n    const response: AxiosResponse<QuizStatsResponse> = await $api.get('/quiz/stats/')\n    const payload = {\n      level_stats: response.data.level_stats ?? {},\n      recent_attempts: response.data.recent_attempts ?? [],\n      total_attempts: response.data.total_attempts ?? 0,\n      average_score: response.data.average_score ?? 0,\n      best_score: response.data.best_score ?? 0,\n    }\n    quizStats.value = payload\n    return payload\n  }\n\n  const refreshAllStats = async () => {\n    syncing.value = true\n    try {\n      const [user, quiz] = await Promise.all([refreshUserStats(), refreshQuizStats()])\n      return { user, quiz }\n    } finally {\n      syncing.value = false\n    }\n  }\n\n  return {\n    userStats,\n    quizStats,\n    syncing,\n    refreshUserStats,\n    refreshQuizStats,\n    refreshAllStats,\n  }\n}\n"],"version":3}