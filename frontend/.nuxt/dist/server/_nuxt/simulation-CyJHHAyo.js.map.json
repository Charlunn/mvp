{"file":"simulation-CyJHHAyo.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_ssrRenderComponent","_push","_parent","_","_scopeId","_createVNode","_ssrRenderList","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual","_ssrInterpolate","_ssrRenderStyle","_ssrRenderClass","_toDisplayString","_createTextVNode","_createBlock","_Fragment","_renderList","_vModelSelect","_openBlock","CapabilityRadar"],"sources":["../../../../pages/simulation.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-6\">\n    <PageHeader\n      title=\"AI 场景模拟\"\n      description=\"选择高发诈骗场景，与 AI 角色进行多轮对练，及时总结识别要点。\"\n    />\n\n    <Card class=\"border border-border/80\">\n      <CardHeader>\n        <CardTitle>对话操作台</CardTitle>\n        <CardDescription>配置场景与模式，AI 将模拟真实话术与你交互。</CardDescription>\n      </CardHeader>\n      <CardContent class=\"space-y-4\">\n        <div class=\"grid gap-4 md:grid-cols-3\">\n          <div>\n            <Label>场景</Label>\n            <select\n              v-model=\"scenario.type\"\n              class=\"w-full rounded-md border border-border bg-background p-2 text-sm\"\n              :disabled=\"sessionClosed\"\n            >\n              <option v-for=\"option in scenarioOptions\" :key=\"option.value\" :value=\"option.value\">\n                {{ option.label }}\n              </option>\n            </select>\n          </div>\n          <div>\n            <Label>难度</Label>\n            <select\n              v-model=\"scenario.difficulty\"\n              class=\"w-full rounded-md border border-border bg-background p-2 text-sm\"\n              :disabled=\"sessionClosed\"\n            >\n              <option v-for=\"option in difficultyOptions\" :key=\"option.value\" :value=\"option.value\">\n                {{ option.label }}\n              </option>\n            </select>\n          </div>\n          <div>\n            <Label>模式</Label>\n            <select\n              v-model=\"scenario.mode\"\n              class=\"w-full rounded-md border border-border bg-background p-2 text-sm\"\n              :disabled=\"sessionClosed\"\n            >\n              <option v-for=\"option in modeOptions\" :key=\"option.value\" :value=\"option.value\">\n                {{ option.label }}\n              </option>\n            </select>\n          </div>\n        </div>\n\n        <div class=\"rounded-2xl border border-border/70 bg-card p-4\">\n          <div class=\"flex items-center justify-between text-sm\">\n            <p class=\"font-medium\">对话得分进度</p>\n            <div v-if=\"sessionClosed && finalResult\" class=\"text-right\">\n              <p class=\"text-2xl font-semibold\">\n                {{ finalResult.finalScore }}<span class=\"text-base font-normal\"> / 100</span>\n              </p>\n              <p class=\"text-xs text-muted-foreground\">{{ finalResult.endReasonLabel }}</p>\n            </div>\n            <p v-else class=\"text-xs text-muted-foreground\">完成演练后将显示本次综合得分</p>\n          </div>\n          <div class=\"mt-2 h-2 rounded-full bg-muted\">\n            <div\n              class=\"h-2 rounded-full bg-foreground transition-all\"\n              :style=\"{ width: sessionClosed && finalResult ? finalResult.finalScore + '%' : '0%' }\"\n            ></div>\n          </div>\n        </div>\n\n        <div\n          ref=\"chatBodyRef\"\n          class=\"max-h-[420px] space-y-3 overflow-y-auto rounded-2xl border border-border/70 bg-background/80 p-4 shadow-inner\"\n        >\n          <div\n            v-for=\"(item, index) in conversation\"\n            :key=\"index\"\n            class=\"max-w-[80%] rounded-2xl px-4 py-2 text-sm leading-relaxed\"\n            :class=\"item.role === 'user' ? 'ml-auto bg-foreground text-background' : 'bg-secondary text-foreground'\"\n          >\n            {{ item.content }}\n          </div>\n          <p v-if=\"!conversation.length\" class=\"text-sm text-muted-foreground\">\n            还没有任何消息，先向 AI 发起第一句对话吧。\n          </p>\n        </div>\n\n        <form class=\"flex flex-col gap-3 md:flex-row\" @submit.prevent=\"sendMessage\">\n          <Textarea\n            v-model=\"message\"\n            rows=\"3\"\n            class=\"flex-1\"\n            :disabled=\"sessionClosed\"\n            placeholder=\"描述你的想法、疑问或进一步追问，以锻炼甄别与拒绝能力。\"\n          />\n          <div class=\"flex flex-col gap-2\">\n            <Button type=\"submit\" class=\"gap-2\" :disabled=\"chatLoading || !message.trim() || sessionClosed\">\n              <Icon name=\"lucide:message-circle\" class=\"h-4 w-4\" />\n              {{ chatLoading && !endingEarly ? '发送中...' : '发送' }}\n            </Button>\n            <Button type=\"button\" variant=\"outline\" :disabled=\"chatLoading\" @click=\"resetSession\">\n              重置会话\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"secondary\"\n              :disabled=\"sessionClosed || !conversation.length || chatLoading\"\n              @click=\"endSessionEarly\"\n            >\n              <Icon name=\"lucide:flag\" class=\"h-4 w-4\" />\n              {{ endingEarly ? '结算中...' : '提前结束' }}\n            </Button>\n          </div>\n        </form>\n\n        <p v-if=\"sessionClosed\" class=\"text-sm text-amber-600\">\n          本次演练已结束：{{ finalResult?.endReasonLabel ?? '系统终止' }}，可以重置后开启新的对话。\n        </p>\n      </CardContent>\n    </Card>\n\n    <Card>\n      <CardHeader>\n        <CardTitle>对话总结</CardTitle>\n        <CardDescription>系统自动保存最近一次完整演练，便于复盘与分享。</CardDescription>\n      </CardHeader>\n      <CardContent class=\"space-y-4\">\n        <div v-if=\"displayedResult\" class=\"rounded-2xl border border-border/70 bg-card p-4 text-sm leading-relaxed\">\n          <div class=\"flex flex-wrap items-center gap-2 text-xs text-muted-foreground uppercase tracking-widest\">\n            <span>{{ displayedResult.scenarioType }} · {{ displayedResult.difficulty }} · {{ displayedResult.mode }}</span>\n            <span>轮次 {{ displayedResult.conversationRounds }}</span>\n          </div>\n          <p class=\"mt-3 text-2xl font-semibold\">{{ displayedResult.finalScore }} / 100</p>\n          <p class=\"text-xs text-muted-foreground\">{{ displayedResult.endReasonLabel }}</p>\n\n          <CapabilityRadar v-if=\"radarProfile\" class=\"mt-4 w-full\" :profile=\"radarProfile\" height=\"240px\" />\n\n          <p class=\"mt-4 text-xs uppercase tracking-widest text-muted-foreground\">表现分析</p>\n          <p class=\"mt-2 whitespace-pre-line\">{{ displayedResult.performanceAnalysis }}</p>\n\n          <p class=\"mt-4 text-xs uppercase tracking-widest text-muted-foreground\">改进建议</p>\n          <p class=\"mt-2 whitespace-pre-line\">{{ displayedResult.suggestions }}</p>\n        </div>\n        <p v-else class=\"text-sm text-muted-foreground\">暂无总结，完成一次演练后即可查看详细复盘。</p>\n        <div class=\"flex gap-2\">\n          <Button variant=\"outline\" :disabled=\"latestLoading\" @click=\"fetchLatestResult\">\n            <Icon name=\"lucide:refresh-ccw\" class=\"h-4 w-4\" />\n            {{ latestLoading ? '刷新中...' : '刷新最近记录' }}\n          </Button>\n          <Button variant=\"secondary\" @click=\"resetSession\">重新开始</Button>\n        </div>\n      </CardContent>\n    </Card>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { AxiosError } from 'axios'\nimport { computed, nextTick, onMounted, reactive, ref, watch } from 'vue'\nimport CapabilityRadar from '~/components/simulation/CapabilityRadar.client.vue'\n\ndefinePageMeta({\n  requiresAuth: true,\n})\n\ntype ChatMessage = {\n  role: 'user' | 'assistant'\n  content: string\n}\n\ntype SimulationResult = {\n  scenarioType: string\n  difficulty: string\n  mode: string\n  finalScore: number\n  conversationRounds: number\n  endReasonLabel: string\n  performanceAnalysis: string\n  suggestions: string\n  updatedAt?: string\n  capabilityProfile?: Record<string, number>\n}\n\nconst { $api } = useNuxtApp()\nconst score = ref(50)\nconst message = ref('')\nconst conversation = ref<ChatMessage[]>([])\nconst chatBodyRef = ref<HTMLElement | null>(null)\nconst chatLoading = ref(false)\nconst endingEarly = ref(false)\nconst sessionClosed = ref(false)\nconst finalResult = ref<SimulationResult | null>(null)\nconst latestResult = ref<SimulationResult | null>(null)\nconst latestLoading = ref(false)\n\nconst scenarioOptions = [\n  { label: '杀猪盘 / 感情投资', value: 'pig-butchering' },\n  { label: '钓鱼链接 / 伪装客服', value: 'phishing' },\n  { label: '冒充公检法', value: 'fake-customer-service' },\n  { label: '投资理财骗局', value: 'investment' },\n  { label: '借贷与刷单', value: 'loan' },\n] as const\n\nconst difficultyOptions = [\n  { label: '入门', value: 'easy' },\n  { label: '进阶', value: 'medium' },\n  { label: '挑战', value: 'hard' },\n] as const\n\nconst modeOptions = [\n  { label: '混合博弈（提问 + 引诱）', value: 'mixed' },\n  { label: '纯诈骗话术', value: 'pure_fake' },\n] as const\n\nconst scenario = reactive({\n  type: scenarioOptions[0].value,\n  difficulty: difficultyOptions[1].value,\n  mode: modeOptions[0].value,\n})\n\nconst displayedResult = computed(() => finalResult.value ?? latestResult.value)\nconst radarProfile = computed(() => displayedResult.value?.capabilityProfile ?? null)\n\nconst scrollToBottom = () => {\n  if (chatBodyRef.value) {\n    chatBodyRef.value.scrollTop = chatBodyRef.value.scrollHeight\n  }\n}\n\nconst showToast = (text: string) => {\n  if (process.client) window.alert(text)\n}\n\nconst extractErrorMessage = (error: unknown, fallback: string) => {\n  const axiosError = error as AxiosError<any>\n  const data = axiosError?.response?.data\n  if (typeof data === 'string' && data.trim()) return data\n  if (data?.message) return Array.isArray(data.message) ? data.message[0] : data.message\n  if (data?.detail) return Array.isArray(data.detail) ? data.detail[0] : data.detail\n  return fallback\n}\n\nconst mapResultFromApi = (payload: any): SimulationResult => ({\n  scenarioType: payload.scenario_type ?? scenario.type,\n  difficulty: payload.difficulty ?? scenario.difficulty,\n  mode: payload.mode ?? scenario.mode,\n  finalScore: payload.final_score ?? 0,\n  conversationRounds: payload.conversation_rounds ?? 0,\n  endReasonLabel: payload.end_reason_label ?? '系统结束',\n  performanceAnalysis: payload.performance_analysis ?? '',\n  suggestions: payload.suggestions ?? '',\n  updatedAt: payload.updated_at ?? new Date().toISOString(),\n  capabilityProfile: payload.capability_profile ?? undefined,\n})\n\nconst applyClosurePayload = (payload: any) => {\n  sessionClosed.value = true\n  const mapped = mapResultFromApi(payload)\n  score.value = mapped.finalScore\n  finalResult.value = mapped\n  latestResult.value = mapped\n}\n\nconst fetchLatestResult = async () => {\n  latestLoading.value = true\n  try {\n    const { data } = await $api.get('/chat/latest-result/')\n    if (data.has_result) {\n      latestResult.value = mapResultFromApi(data.data)\n    } else {\n      latestResult.value = null\n    }\n  } catch (error) {\n    console.warn('fetch latest result failed', error)\n  } finally {\n    latestLoading.value = false\n  }\n}\n\nconst sendMessage = async () => {\n  const content = message.value.trim()\n  if (!content || chatLoading.value) return\n  if (sessionClosed.value) {\n    showToast('当前会话已结束，请重新开始。')\n    return\n  }\n\n  chatLoading.value = true\n  const historyPayload = conversation.value.map((item) => ({ role: item.role, content: item.content }))\n  historyPayload.push({ role: 'user', content })\n\n  conversation.value.push({ role: 'user', content })\n  message.value = ''\n\n  try {\n    const { data } = await $api.post('/chat/scenario/stateless/', {\n      message: content,\n      scenario_type: scenario.type,\n      difficulty: scenario.difficulty,\n      mode: scenario.mode,\n      history: historyPayload,\n      current_score: score.value,\n    })\n\n    conversation.value.push({\n      role: 'assistant',\n      content: data.response || 'AI 暂无回复，请稍后再试。',\n    })\n\n    if (data.session_closed) {\n      applyClosurePayload(data)\n    }\n  } catch (error) {\n    showToast(extractErrorMessage(error, '发送失败，请稍后重试'))\n  } finally {\n    chatLoading.value = false\n    nextTick(scrollToBottom)\n  }\n}\n\nconst endSessionEarly = async () => {\n  if (!conversation.value.length || sessionClosed.value || chatLoading.value) return\n  chatLoading.value = true\n  endingEarly.value = true\n  try {\n    const historyPayload = conversation.value.map((item) => ({ role: item.role, content: item.content }))\n    const { data } = await $api.post('/chat/scenario/stateless/', {\n      force_end: true,\n      scenario_type: scenario.type,\n      difficulty: scenario.difficulty,\n      mode: scenario.mode,\n      history: historyPayload,\n      current_score: score.value,\n    })\n\n    if (data.response) {\n      conversation.value.push({ role: 'assistant', content: data.response })\n    }\n\n    if (data.session_closed) {\n      applyClosurePayload(data)\n    }\n  } catch (error) {\n    showToast(extractErrorMessage(error, '结束失败，请稍后再试'))\n  } finally {\n    chatLoading.value = false\n    endingEarly.value = false\n    nextTick(scrollToBottom)\n  }\n}\n\nconst resetSession = async () => {\n  if (chatLoading.value) return\n  try {\n    await $api.post('/chat/scenario/stateless/', {\n      reset: true,\n      scenario_type: scenario.type,\n      difficulty: scenario.difficulty,\n      mode: scenario.mode,\n    })\n  } catch (error) {\n    console.warn('reset session failed', error)\n  } finally {\n    conversation.value = []\n    message.value = ''\n    sessionClosed.value = false\n    finalResult.value = null\n    chatLoading.value = false\n    endingEarly.value = false\n    nextTick(scrollToBottom)\n  }\n}\n\nonMounted(fetchLatestResult)\nwatch(conversation, () => nextTick(scrollToBottom), { deep: true })\n</script>\n"],"version":3}