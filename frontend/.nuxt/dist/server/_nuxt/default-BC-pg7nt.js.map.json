{"file":"default-BC-pg7nt.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_unref","_ssrRenderList","_push","_parent","_ssrInterpolate","_createVNode","_toDisplayString","_createBlock","_ssrRenderClass","_createTextVNode","_renderSlot"],"sources":["../../../../components/layout/ThemeToggle.vue","../../../../node_modules/nuxt/dist/app/compat/interval.js","../../../../composables/useNotifications.ts","../../../../components/layout/AppShell.vue","../../../../layouts/default.vue"],"sourcesContent":["<template>\n  <button\n    class=\"flex h-9 w-9 items-center justify-center rounded-full border border-border text-sm font-semibold transition hover:bg-secondary\"\n    @click=\"toggleTheme\"\n  >\n    <Icon :name=\"isDark ? 'lucide:moon' : 'lucide:sun'\" class=\"h-4 w-4\" />\n  </button>\n</template>\n\n<script setup lang=\"ts\">\nconst isDark = useState('mvp-theme', () => false)\n\nif (process.client) {\n  isDark.value = document.documentElement.classList.contains('dark')\n}\n\nconst toggleTheme = () => {\n  isDark.value = !isDark.value\n  if (process.client) {\n    document.documentElement.classList.toggle('dark', isDark.value)\n  }\n}\n</script>\n","import { createError } from \"../composables/error.js\";\nconst intervalError = \"[nuxt] `setInterval` should not be used on the server. Consider wrapping it with an `onNuxtReady`, `onBeforeMount` or `onMounted` lifecycle hook, or ensure you only call it in the browser by checking `import.meta.client`.\";\nexport const setInterval = import.meta.client ? globalThis.setInterval : () => {\n  if (import.meta.dev) {\n    throw createError({\n      statusCode: 500,\n      message: intervalError\n    });\n  }\n  console.error(intervalError);\n};\n","import { ref, onMounted, onUnmounted } from 'vue'\n\nexport function useNotifications() {\n  const { $api } = useNuxtApp()\n  const auth = useAuthStore()\n\n  const unreadCount = ref(0)\n  let pollingTimer: NodeJS.Timeout | null = null\n\n  async function fetchUnreadCount() {\n    if (!auth.isAuthenticated) return\n    try {\n      const { data } = await $api.get('/notifications/unread-count/')\n      unreadCount.value = data.unread_count\n    } catch (error) {\n      console.error('Failed to fetch unread notification count:', error)\n    }\n  }\n\n  function startPolling(interval = 60000) {\n    if (pollingTimer) {\n      stopPolling()\n    }\n    pollingTimer = setInterval(fetchUnreadCount, interval)\n  }\n\n  function stopPolling() {\n    if (pollingTimer) {\n      clearInterval(pollingTimer)\n      pollingTimer = null\n    }\n  }\n\n  onMounted(() => {\n    if (auth.isAuthenticated) {\n      fetchUnreadCount()\n      startPolling()\n    }\n  })\n\n  onUnmounted(() => {\n    stopPolling()\n  })\n\n  watch(() => auth.isAuthenticated, (isAuth) => {\n    if (isAuth) {\n      fetchUnreadCount()\n      startPolling()\n    } else {\n      unreadCount.value = 0\n      stopPolling()\n    }\n  })\n\n  return {\n    unreadCount,\n    fetchUnreadCount,\n  }\n}\n","<template>\r\n  <div class=\"bg-background text-foreground min-h-screen md:grid md:grid-cols-[240px_1fr] md:items-start\">\r\n    <aside\r\n      class=\"hidden md:flex md:sticky md:top-0 md:h-screen md:self-start md:overflow-y-auto flex-col border-r border-border px-6 py-8 gap-8\"\r\n    >\r\n      <div>\r\n        <p class=\"text-sm uppercase tracking-[0.3em] text-muted-foreground\">VirifySpring</p>\r\n        <p class=\"text-lg font-semibold\">澄源</p>\r\n      </div>\r\n      <nav class=\"space-y-1\">\r\n        <NuxtLink\r\n          v-for=\"item in navItems\"\r\n          :key=\"item.to\"\r\n          :to=\"item.to\"\r\n          class=\"flex items-center justify-between rounded-lg border border-transparent px-3 py-2 text-sm font-medium transition hover:border-border hover:bg-secondary\"\r\n          :class=\"isActive(item.to) ? 'bg-secondary border-border text-foreground' : 'text-muted-foreground'\"\r\n        >\r\n          <div class=\"flex items-center gap-2\">\r\n            <span>{{ item.label }}</span>\r\n            <span\r\n              v-if=\"item.label === '消息中心' && unreadCount > 0\"\r\n              class=\"bg-primary text-primary-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center\"\r\n            >\r\n              {{ unreadCount }}\r\n            </span>\r\n          </div>\r\n          <Icon :name=\"item.icon\" class=\"h-4 w-4\" />\r\n        </NuxtLink>\r\n      </nav>\r\n\r\n      <div class=\"rounded-xl border border-border/70 bg-secondary/30 p-4 text-sm\">\r\n        <div class=\"flex items-start justify-between\">\r\n          <div>\r\n            <p class=\"text-xs uppercase tracking-wide text-muted-foreground\">登录状态</p>\r\n            <p class=\"mt-1 text-base font-semibold\">{{ userDisplayName }}</p>\r\n          </div>\r\n          <span\r\n            class=\"inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium\"\r\n            :class=\"auth.isAuthenticated ? 'bg-emerald-500/15 text-emerald-500' : 'bg-muted text-muted-foreground'\"\r\n          >\r\n            {{ auth.isAuthenticated ? '在线' : '未登录' }}\r\n          </span>\r\n        </div>\r\n        <p class=\"mt-3 text-xs text-muted-foreground\">\r\n          {{ auth.isAuthenticated ? '已连接至反诈风控系统，可直接使用所有功能。' : '访问受限，请先完成登录。' }}\r\n        </p>\r\n        <Button\r\n          class=\"mt-4 w-full justify-center gap-2\"\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          :disabled=\"logoutLoading\"\r\n          @click=\"handleAuthAction\"\r\n        >\r\n          <Icon :name=\"auth.isAuthenticated ? 'lucide:log-out' : 'lucide:log-in'\" class=\"h-4 w-4\" />\r\n          {{ auth.isAuthenticated ? (logoutLoading ? '正在退出' : '退出登录') : '前往登录' }}\r\n        </Button>\r\n      </div>\r\n\r\n      <div class=\"mt-auto text-xs text-muted-foreground\">\r\n        <p class=\"mt-1\">{{ today }}</p>\r\n      </div>\r\n    </aside>\r\n\r\n    <div class=\"flex flex-col min-h-screen\">\r\n      <header\r\n        class=\"sticky top-0 z-20 flex items-center justify-between border-b border-border bg-background/95 px-4 py-3 backdrop-blur md:hidden\"\r\n      >\r\n        <button class=\"text-sm font-semibold\" @click=\"drawerOpen = !drawerOpen\">\r\n          菜单\r\n        </button>\r\n        <NuxtLink to=\"/\" class=\"font-semibold\">澄源反诈平台</NuxtLink>\r\n        <div class=\"flex items-center gap-2\">\r\n          <NuxtLink to=\"/notifications\" class=\"relative\">\r\n            <Icon name=\"lucide:bell\" class=\"h-5 w-5\" />\r\n            <span\r\n              v-if=\"unreadCount > 0\"\r\n              class=\"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs rounded-full h-4 w-4 flex items-center justify-center\"\r\n            >\r\n              {{ unreadCount }}\r\n            </span>\r\n          </NuxtLink>\r\n          <ThemeToggle />\r\n        </div>\r\n      </header>\r\n      <Transition name=\"fade\">\r\n        <div v-if=\"drawerOpen\" class=\"md:hidden border-b border-border bg-background px-4 py-4 space-y-4\">\r\n          <nav class=\"space-y-1\">\r\n            <NuxtLink\r\n              v-for=\"item in navItems\"\r\n              :key=\"item.to\"\r\n              :to=\"item.to\"\r\n              class=\"flex items-center justify-between rounded-lg px-3 py-2 text-sm font-medium\"\r\n              :class=\"isActive(item.to) ? 'bg-secondary text-foreground' : 'text-muted-foreground'\"\r\n              @click=\"drawerOpen = false\"\r\n            >\r\n              <span>{{ item.label }}</span>\r\n              <span\r\n                v-if=\"item.label === '消息中心' && unreadCount > 0\"\r\n                class=\"bg-primary text-primary-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center\"\r\n              >\r\n                {{ unreadCount }}\r\n              </span>\r\n            </NuxtLink>\r\n          </nav>\r\n          <div class=\"rounded-lg border border-border/80 p-3 text-sm\">\r\n            <p class=\"text-xs text-muted-foreground\">当前状态</p>\r\n            <div class=\"mt-1 flex items-center justify-between\">\r\n              <span class=\"font-medium\">{{ userDisplayName }}</span>\r\n              <span class=\"text-xs text-muted-foreground\">\r\n                {{ auth.isAuthenticated ? '在线' : '未登录' }}\r\n              </span>\r\n            </div>\r\n            <Button\r\n              class=\"mt-3 w-full justify-center gap-2\"\r\n              size=\"sm\"\r\n              variant=\"outline\"\r\n              :disabled=\"logoutLoading\"\r\n              @click=\"handleMobileAuthAction\"\r\n            >\r\n              <Icon :name=\"auth.isAuthenticated ? 'lucide:log-out' : 'lucide:log-in'\" class=\"h-4 w-4\" />\r\n              {{ auth.isAuthenticated ? (logoutLoading ? '正在退出' : '退出登录') : '前往登录' }}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </Transition>\r\n      <main class=\"flex-1 px-4 py-6 md:px-10\">\r\n        <slot />\r\n      </main>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport ThemeToggle from '~/components/layout/ThemeToggle.vue'\r\nimport { useNotifications } from '~/composables/useNotifications'\r\n\r\nconst route = useRoute()\r\nconst drawerOpen = ref(false)\r\nconst auth = useAuthStore()\r\nconst logoutLoading = ref(false)\r\nconst { unreadCount } = useNotifications()\r\n\r\nconst navItems = [\r\n  { label: '概览', to: '/', icon: 'lucide:layout-dashboard' },\r\n  { label: '社区广场', to: '/community', icon: 'lucide:users-round' },\r\n  { label: '消息中心', to: '/notifications', icon: 'lucide:bell' },\r\n  { label: '知识测验', to: '/quiz', icon: 'lucide:badge-check' },\r\n  { label: 'AI 场景模拟', to: '/simulation', icon: 'lucide:bot' },\r\n  { label: '知识图谱', to: '/graph', icon: 'lucide:share-2' },\r\n  { label: '个人主页', to: '/profile', icon: 'lucide:user-round' },\r\n]\r\n\r\nconst isActive = (path: string) => {\r\n  if (path === '/') {\r\n    return route.path === '/'\r\n  }\r\n  return route.path.startsWith(path)\r\n}\r\n\r\nconst userDisplayName = computed(() => auth.user?.nickname || auth.user?.username || '访客')\r\nconst today = new Date().toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })\r\n\r\nconst handleMobileAuthAction = () => {\r\n  drawerOpen.value = false\r\n  handleAuthAction()\r\n}\r\n\r\nconst handleAuthAction = async () => {\r\n  if (!auth.isAuthenticated) {\r\n    navigateTo('/login')\r\n    return\r\n  }\r\n  if (logoutLoading.value) return\r\n  logoutLoading.value = true\r\n  try {\r\n    await auth.logout()\r\n    navigateTo('/login')\r\n  } finally {\r\n    logoutLoading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.fade-enter-active,\r\n.fade-leave-active {\r\n  transition: opacity 0.2s ease;\r\n}\r\n.fade-enter-from,\r\n.fade-leave-to {\r\n  opacity: 0;\r\n}\r\n</style>\r\n","<template>\n  <AppShell>\n    <slot />\n  </AppShell>\n</template>\n\n<script setup lang=\"ts\">\nimport AppShell from '~/components/layout/AppShell.vue'\n</script>\n"],"version":3}