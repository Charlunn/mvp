import{u as V,_ as S}from"./DzNSn88N.js";import{_ as E}from"./38tOet_I.js";import{_ as F}from"./CCRcQfJ_.js";import{g as A,c as f,o as m,b as l,v as t,k as q,j as z,r as w,n as M,a4 as P,C as R,a1 as U,m as H,a as e,F as T,s as $,t as r,H as v,w as p,T as O,R as L,q as y,d as k,N as I,_ as W,p as G}from"./C4cmwJeW.js";import"./CTtaAHph.js";const J=A({__name:"ThemeToggle",setup(b){const o=V("mvp-theme",()=>!1);o.value=document.documentElement.classList.contains("dark");const i=()=>{o.value=!o.value,document.documentElement.classList.toggle("dark",o.value)};return(s,n)=>{const c=S;return m(),f("button",{class:"flex h-9 w-9 items-center justify-center rounded-full border border-border text-sm font-semibold transition hover:bg-secondary",onClick:i},[l(c,{name:t(o)?"lucide:moon":"lucide:sun",class:"h-4 w-4"},null,8,["name"])])}}}),K=globalThis.setInterval;function Q(){const{$api:b}=q(),o=z(),i=w(0);let s=null;async function n(){if(o.isAuthenticated)try{const{data:u}=await b.get("/notifications/unread-count/");i.value=u.unread_count}catch(u){console.error("Failed to fetch unread notification count:",u)}}function c(u=6e4){s&&_(),s=K(n,u)}function _(){s&&(clearInterval(s),s=null)}return M(()=>{o.isAuthenticated&&(n(),c())}),P(()=>{_()}),R(()=>o.isAuthenticated,u=>{u?(n(),c()):(i.value=0,_())}),{unreadCount:i,fetchUnreadCount:n}}const X={class:"bg-background text-foreground min-h-screen md:grid md:grid-cols-[240px_1fr] md:items-start"},Y={class:"hidden md:flex md:sticky md:top-0 md:h-screen md:self-start md:overflow-y-auto flex-col border-r border-border px-6 py-8 gap-8"},Z={class:"space-y-1"},ee={class:"flex items-center gap-2"},te={key:0,class:"bg-primary text-primary-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center"},se={class:"rounded-xl border border-border/70 bg-secondary/30 p-4 text-sm"},oe={class:"flex items-start justify-between"},ne={class:"mt-1 text-base font-semibold"},ae={class:"mt-3 text-xs text-muted-foreground"},re={class:"mt-auto text-xs text-muted-foreground"},le={class:"mt-1"},ie={class:"flex flex-col min-h-screen"},de={class:"sticky top-0 z-20 flex items-center justify-between border-b border-border bg-background/95 px-4 py-3 backdrop-blur md:hidden"},ce={class:"flex items-center gap-2"},ue={key:0,class:"absolute -top-1 -right-1 bg-primary text-primary-foreground text-xs rounded-full h-4 w-4 flex items-center justify-center"},me={key:0,class:"md:hidden border-b border-border bg-background px-4 py-4 space-y-4"},fe={class:"space-y-1"},pe={key:0,class:"bg-primary text-primary-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center"},_e={class:"rounded-lg border border-border/80 p-3 text-sm"},be={class:"mt-1 flex items-center justify-between"},xe={class:"font-medium"},ge={class:"text-xs text-muted-foreground"},he={class:"flex-1 px-4 py-6 md:px-10"},ye=A({__name:"AppShell",setup(b){const o=U(),i=w(!1),s=z(),n=w(!1),{unreadCount:c}=Q(),_=[{label:"概览",to:"/",icon:"lucide:layout-dashboard"},{label:"社区广场",to:"/community",icon:"lucide:users-round"},{label:"消息中心",to:"/notifications",icon:"lucide:bell"},{label:"知识测验",to:"/quiz",icon:"lucide:badge-check"},{label:"AI 场景模拟",to:"/simulation",icon:"lucide:bot"},{label:"知识图谱",to:"/graph",icon:"lucide:share-2"},{label:"个人主页",to:"/profile",icon:"lucide:user-round"}],u=x=>x==="/"?o.path==="/":o.path.startsWith(x),C=H(()=>s.user?.nickname||s.user?.username||"访客"),B=new Date().toLocaleDateString("zh-CN",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),D=()=>{i.value=!1,j()},j=async()=>{if(!s.isAuthenticated){I("/login");return}if(!n.value){n.value=!0;try{await s.logout(),I("/login")}finally{n.value=!1}}};return(x,d)=>{const g=S,h=E,N=F;return m(),f("div",X,[e("aside",Y,[d[3]||(d[3]=e("div",null,[e("p",{class:"text-sm uppercase tracking-[0.3em] text-muted-foreground"},"VirifySpring"),e("p",{class:"text-lg font-semibold"},"澄源")],-1)),e("nav",Z,[(m(),f(T,null,$(_,a=>l(h,{key:a.to,to:a.to,class:v(["flex items-center justify-between rounded-lg border border-transparent px-3 py-2 text-sm font-medium transition hover:border-border hover:bg-secondary",u(a.to)?"bg-secondary border-border text-foreground":"text-muted-foreground"])},{default:p(()=>[e("div",ee,[e("span",null,r(a.label),1),a.label==="消息中心"&&t(c)>0?(m(),f("span",te,r(t(c)),1)):y("",!0)]),l(g,{name:a.icon,class:"h-4 w-4"},null,8,["name"])]),_:2},1032,["to","class"])),64))]),e("div",se,[e("div",oe,[e("div",null,[d[2]||(d[2]=e("p",{class:"text-xs uppercase tracking-wide text-muted-foreground"},"登录状态",-1)),e("p",ne,r(t(C)),1)]),e("span",{class:v(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",t(s).isAuthenticated?"bg-emerald-500/15 text-emerald-500":"bg-muted text-muted-foreground"])},r(t(s).isAuthenticated?"在线":"未登录"),3)]),e("p",ae,r(t(s).isAuthenticated?"已连接至反诈风控系统，可直接使用所有功能。":"访问受限，请先完成登录。"),1),l(N,{class:"mt-4 w-full justify-center gap-2",variant:"outline",size:"sm",disabled:t(n),onClick:j},{default:p(()=>[l(g,{name:t(s).isAuthenticated?"lucide:log-out":"lucide:log-in",class:"h-4 w-4"},null,8,["name"]),k(" "+r(t(s).isAuthenticated?t(n)?"正在退出":"退出登录":"前往登录"),1)]),_:1},8,["disabled"])]),e("div",re,[e("p",le,r(t(B)),1)])]),e("div",ie,[e("header",de,[e("button",{class:"text-sm font-semibold",onClick:d[0]||(d[0]=a=>i.value=!t(i))}," 菜单 "),l(h,{to:"/",class:"font-semibold"},{default:p(()=>[...d[4]||(d[4]=[k("澄源反诈平台",-1)])]),_:1}),e("div",ce,[l(h,{to:"/notifications",class:"relative"},{default:p(()=>[l(g,{name:"lucide:bell",class:"h-5 w-5"}),t(c)>0?(m(),f("span",ue,r(t(c)),1)):y("",!0)]),_:1}),l(J)])]),l(O,{name:"fade"},{default:p(()=>[t(i)?(m(),f("div",me,[e("nav",fe,[(m(),f(T,null,$(_,a=>l(h,{key:a.to,to:a.to,class:v(["flex items-center justify-between rounded-lg px-3 py-2 text-sm font-medium",u(a.to)?"bg-secondary text-foreground":"text-muted-foreground"]),onClick:d[1]||(d[1]=ke=>i.value=!1)},{default:p(()=>[e("span",null,r(a.label),1),a.label==="消息中心"&&t(c)>0?(m(),f("span",pe,r(t(c)),1)):y("",!0)]),_:2},1032,["to","class"])),64))]),e("div",_e,[d[5]||(d[5]=e("p",{class:"text-xs text-muted-foreground"},"当前状态",-1)),e("div",be,[e("span",xe,r(t(C)),1),e("span",ge,r(t(s).isAuthenticated?"在线":"未登录"),1)]),l(N,{class:"mt-3 w-full justify-center gap-2",size:"sm",variant:"outline",disabled:t(n),onClick:D},{default:p(()=>[l(g,{name:t(s).isAuthenticated?"lucide:log-out":"lucide:log-in",class:"h-4 w-4"},null,8,["name"]),k(" "+r(t(s).isAuthenticated?t(n)?"正在退出":"退出登录":"前往登录"),1)]),_:1},8,["disabled"])])])):y("",!0)]),_:1}),e("main",he,[L(x.$slots,"default",{},void 0,!0)])])])}}}),ve=W(ye,[["__scopeId","data-v-bb8fb9a5"]]),Te=A({__name:"default",setup(b){return(o,i)=>(m(),G(ve,null,{default:p(()=>[L(o.$slots,"default")]),_:3}))}});export{Te as default};
