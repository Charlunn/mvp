import{_ as H}from"./DzNSn88N.js";import{_ as G}from"./CCRcQfJ_.js";import{d as J,_ as K,b as O,a as Q,c as U}from"./Bnx0PPvk.js";import{_ as W}from"./DLa9Lqb7.js";import{g as X,j as Y,k as Z,r as C,m as f,n as ee,c as u,a as t,t as l,v as c,b as s,w as o,F as h,s as N,o as d,d as r,N as y,p as q,q as z}from"./C4cmwJeW.js";import{_ as te}from"./BB_Ta-Np.js";import{u as se}from"./BsCiWU7Q.js";import"./CTtaAHph.js";import"./hg5aJybS.js";const oe={class:"space-y-8"},ae={class:"flex flex-wrap items-end justify-between gap-4"},ne={class:"mt-1 text-3xl font-semibold"},le={class:"flex gap-3"},re={class:"grid gap-4 md:grid-cols-4"},ie={class:"text-xs text-muted-foreground"},de={class:"grid gap-6 lg:grid-cols-2"},ue={key:0,class:"text-sm text-muted-foreground"},ce={key:1,class:"space-y-4"},me={class:"font-medium"},pe={class:"text-xs text-muted-foreground"},fe={key:0,class:"text-sm text-muted-foreground"},_e={class:"grid gap-3"},ve={class:"grid gap-6 lg:grid-cols-2"},ge={key:0,class:"space-y-4"},be={class:"grid gap-4 sm:grid-cols-2"},xe={class:"mt-1 font-medium"},ye={class:"mt-1 font-medium capitalize"},ke={class:"mt-1 font-medium"},we={class:"mt-1 font-medium"},$e={class:"grid gap-4 sm:grid-cols-2"},Se={class:"rounded-xl border border-border/70 p-4 text-center"},Ce={class:"mt-2 text-3xl font-semibold"},Te={class:"rounded-xl border border-border/70 p-4 text-center"},Ae={class:"mt-2 text-base font-medium"},he={class:"rounded-xl border border-dashed border-border/70 bg-muted/40 p-4 text-sm"},Ne={class:"mt-2 text-muted-foreground"},qe={key:1,class:"text-sm text-muted-foreground"},Ee=X({__name:"index",setup(ze){const $=Y(),{$api:V}=Z(),{userStats:j,quizStats:S,refreshAllStats:B}=se(),F={beginner:"初级训练",intermediate:"中级训练",advanced:"高级训练"},m=C(!0),k=C("-"),i=C(null),I=f(()=>j.value?.quiz_attempts_count??0),P=f(()=>S.value?.average_score??0),D=f(()=>S.value?.best_score??0),T=f(()=>S.value?.recent_attempts??[]),L=a=>new Date(a).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=f(()=>i.value?.capabilityProfile??null),A=a=>(typeof a=="number"&&Number.isFinite(a)?a:0).toFixed(2).replace(/\.00$/,"").replace(/(\.\d)0$/,"$1"),M=f(()=>[{label:"累计测验次数",value:m.value?"-":I.value.toString(),hint:"包含所有历史答题"},{label:"平均得分",value:m.value?"-":`${A(P.value)}%`,hint:"最近测验平均成绩"},{label:"最佳成绩",value:m.value?"-":`${A(D.value)}%`,hint:"历史最高成绩"},{label:"AI 模拟得分",value:k.value,hint:"最近一次 AI 场景"}]);return ee(async()=>{m.value=!0;try{await B()}catch(a){console.error("Failed to refresh quiz / user stats",a)}finally{m.value=!1}try{const{data:a}=await V.get("/chat/latest-result/");if(a?.has_result){const e=a.data;i.value={scenarioType:e.scenario_type,difficulty:e.difficulty,mode:e.mode,finalScore:e.final_score,conversationRounds:e.conversation_rounds,endReasonLabel:e.end_reason_label,performanceAnalysis:e.performance_analysis,capabilityProfile:e.capability_profile},k.value=`${e.final_score} 分`}else i.value=null,k.value="-"}catch(a){console.warn("Failed to fetch simulation result",a),i.value=null,k.value="-"}}),(a,e)=>{const p=H,_=G,v=O,g=Q,b=K,x=J,E=W,w=U;return d(),u("div",oe,[t("section",ae,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm uppercase tracking-widest text-muted-foreground"},"MVP / Dashboard",-1)),t("h1",ne,"欢迎回来，"+l(c($).user?.nickname||c($).user?.username),1)]),t("div",le,[s(_,{variant:"outline",class:"gap-2",onClick:e[0]||(e[0]=n=>("navigateTo"in a?a.navigateTo:c(y))("/profile"))},{default:o(()=>[s(p,{name:"lucide:user",class:"h-4 w-4"}),e[6]||(e[6]=r(" 我的主页 ",-1))]),_:1}),s(_,{class:"gap-2",onClick:e[1]||(e[1]=n=>("navigateTo"in a?a.navigateTo:c(y))("/quiz"))},{default:o(()=>[s(p,{name:"lucide:play",class:"h-4 w-4"}),e[7]||(e[7]=r(" 开始测验 ",-1))]),_:1})])]),t("section",re,[(d(!0),u(h,null,N(M.value,n=>(d(),q(x,{key:n.label,class:"border border-border/80"},{default:o(()=>[s(b,{class:"space-y-2"},{default:o(()=>[s(v,null,{default:o(()=>[r(l(n.label),1)]),_:2},1024),s(g,{class:"text-3xl"},{default:o(()=>[r(l(n.value),1)]),_:2},1024),t("p",ie,l(n.hint),1)]),_:2},1024)]),_:2},1024))),128))]),t("section",de,[s(x,{class:"border border-border/80"},{default:o(()=>[s(b,null,{default:o(()=>[s(g,null,{default:o(()=>[...e[8]||(e[8]=[r("个人测验概况",-1)])]),_:1}),s(v,null,{default:o(()=>[...e[9]||(e[9]=[r("最近 5 次测验表现（按时间倒序）",-1)])]),_:1})]),_:1}),s(w,null,{default:o(()=>[m.value?(d(),u("div",ue,"加载中...")):(d(),u("div",ce,[(d(!0),u(h,null,N(T.value,n=>(d(),u("div",{key:n.created_at,class:"flex items-center justify-between rounded-xl border border-border/70 bg-card px-4 py-3 text-sm"},[t("div",null,[t("p",me,l(F[n.level]||"未知等级"),1),t("p",pe,l(L(n.created_at)),1)]),s(E,null,{default:o(()=>[r(l(n.score)+" 分",1)]),_:2},1024)]))),128)),T.value.length?z("",!0):(d(),u("p",fe,"暂无测验记录，先去完成一场测验吧。"))]))]),_:1})]),_:1}),s(x,{class:"border border-border/80"},{default:o(()=>[s(b,null,{default:o(()=>[s(g,null,{default:o(()=>[...e[10]||(e[10]=[r("系统快捷入口",-1)])]),_:1}),s(v,null,{default:o(()=>[...e[11]||(e[11]=[r("快速跳转到核心 MVP 功能",-1)])]),_:1})]),_:1}),s(w,null,{default:o(()=>[t("div",_e,[s(_,{variant:"outline",class:"justify-between",onClick:e[2]||(e[2]=n=>("navigateTo"in a?a.navigateTo:c(y))("/simulation"))},{default:o(()=>[e[12]||(e[12]=t("span",null,"AI 场景模拟",-1)),s(p,{name:"lucide:bot",class:"h-4 w-4"})]),_:1}),s(_,{variant:"outline",class:"justify-between",onClick:e[3]||(e[3]=n=>("navigateTo"in a?a.navigateTo:c(y))("/graph"))},{default:o(()=>[e[13]||(e[13]=t("span",null,"知识图谱可视化",-1)),s(p,{name:"lucide:network",class:"h-4 w-4"})]),_:1}),c($).isAdmin?(d(),q(_,{key:0,variant:"outline",class:"justify-between",onClick:e[4]||(e[4]=n=>("navigateTo"in a?a.navigateTo:c(y))("/admin/questions"))},{default:o(()=>[e[14]||(e[14]=t("span",null,"题库管理（管理员）",-1)),s(p,{name:"lucide:shield",class:"h-4 w-4"})]),_:1})):z("",!0)])]),_:1})]),_:1})]),t("section",ve,[s(x,{class:"border border-border/80"},{default:o(()=>[s(b,null,{default:o(()=>[s(g,null,{default:o(()=>[...e[15]||(e[15]=[r("最新 AI 场景模拟",-1)])]),_:1}),s(v,null,{default:o(()=>[...e[16]||(e[16]=[r("回顾最近一次对话式演练",-1)])]),_:1})]),_:1}),s(w,null,{default:o(()=>[i.value?(d(),u("div",ge,[t("div",be,[t("div",null,[e[17]||(e[17]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"场景类别",-1)),t("p",xe,l(i.value.scenarioType),1)]),t("div",null,[e[18]||(e[18]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"难度",-1)),t("p",ye,l(i.value.difficulty),1)]),t("div",null,[e[19]||(e[19]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"模式",-1)),t("p",ke,l(i.value.mode),1)]),t("div",null,[e[20]||(e[20]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"对话轮次",-1)),t("p",we,l(i.value.conversationRounds),1)])]),t("div",$e,[t("div",Se,[e[21]||(e[21]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"最终得分",-1)),t("p",Ce,l(i.value.finalScore)+" 分",1)]),t("div",Te,[e[22]||(e[22]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"结束原因",-1)),t("p",Ae,l(i.value.endReasonLabel),1)])]),t("div",he,[e[23]||(e[23]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"表现综述",-1)),t("p",Ne,l(i.value.performanceAnalysis),1)])])):(d(),u("p",qe," 暂无模拟记录，前往 AI 场景模拟体验一场完整的对话演练。 "))]),_:1})]),_:1}),s(x,{class:"border border-border/80"},{default:o(()=>[s(b,null,{default:o(()=>[s(g,null,{default:o(()=>[...e[24]||(e[24]=[r("能力雷达图",-1)])]),_:1}),s(v,null,{default:o(()=>[...e[25]||(e[25]=[r("从多个维度评估反诈能力",-1)])]),_:1})]),_:1}),s(w,{class:"p-4"},{default:o(()=>[s(te,{profile:R.value,height:"320px"},null,8,["profile"])]),_:1})]),_:1})])])}}});export{Ee as default};
