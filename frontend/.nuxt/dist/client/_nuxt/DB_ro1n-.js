import{_ as me}from"./pP1PrXx_.js";import{_ as _e,a as pe,b as ve,c as be,d as fe}from"./Bnx0PPvk.js";import{_ as ge}from"./DzNSn88N.js";import{_ as xe}from"./CCRcQfJ_.js";import{_ as ye}from"./D3KgOzdW.js";import{_ as we}from"./BgC2Tqll.js";import{_ as ke}from"./BtdkqM2g.js";import{g as he,j as Ce,k as Ae,r as p,l as G,m as C,n as Se,c as u,o as d,b as a,p as ze,q as B,w as r,d as i,a as t,F as y,s as w,v as s,t as n,x as O,y as Ve,z as $e,A as J}from"./C4cmwJeW.js";import{u as qe}from"./BsCiWU7Q.js";import"./CTtaAHph.js";const Be={class:"space-y-6"},Qe={class:"flex flex-wrap gap-3"},Ue={key:0,class:"flex items-center gap-3 rounded-lg border border-border/70 bg-secondary/30 px-4 py-3 text-sm text-muted-foreground"},Le={key:1,class:"space-y-3"},Me={key:2},Ne={key:0,class:"space-y-4"},De={class:"text-sm uppercase tracking-widest text-muted-foreground"},Fe={class:"mt-2 text-base font-medium"},je={class:"mt-3 grid gap-2"},Ee={class:"flex items-center gap-3"},Te=["name","value","onUpdate:modelValue","disabled"],He={class:"text-xs text-muted-foreground"},Ie={key:1,class:"flex flex-col items-center gap-3 rounded-xl border border-dashed border-border/70 bg-muted/10 p-6 text-center text-sm text-muted-foreground"},Oe={key:0,class:"text-xs"},Re={class:"text-sm text-muted-foreground"},Pe={class:"flex items-center gap-3"},Ze={key:0,class:"text-sm text-muted-foreground"},Ge={class:"rounded-xl border border-border/60 p-4"},Je={class:"mt-2 text-3xl font-semibold"},Ke={class:"rounded-xl border border-border/60 p-4"},We={class:"mt-2 text-3xl font-semibold"},Xe={class:"rounded-xl border border-border/60 p-4"},Ye={class:"mt-2 text-3xl font-semibold"},et={class:"grid grid-cols-2 gap-3"},tt={class:"grid grid-cols-2 gap-3"},st=["value"],lt={class:"space-y-3"},ot={class:"font-medium"},at={class:"text-xs text-muted-foreground mt-1"},rt=5,gt=he({__name:"quiz",setup(nt){const Q=Ce(),{$api:A}=Ae(),{quizStats:K,refreshQuizStats:W,refreshAllStats:X}=qe(),Y=[{value:"beginner",label:"初级",icon:"lucide:leaf"},{value:"intermediate",label:"中级",icon:"lucide:kanban"},{value:"advanced",label:"高级",icon:"lucide:zap"}],U={beginner:"初级训练",intermediate:"中级训练",advanced:"高级训练"},L=p("beginner"),m=p([]),f=G({}),g=p(!0),S=p(!1),v=p(null),c=p(null),z=p(null),ee={total_attempts:0,average_score:0,best_score:0,level_stats:{},recent_attempts:[]},M=C(()=>K.value??ee),_=G({text:"",level:"beginner",option_a:"",option_b:"",option_c:"",option_d:"",correct_answer:"A"}),R=p([]),V=p(!1),te=l=>Array.isArray(l)?l:l&&Array.isArray(l.results)?l.results:[],se=()=>{Object.keys(f).forEach(l=>delete f[Number(l)])},N=()=>{c.value=null,z.value=null,m.value=[],se()},$=C(()=>m.value.reduce((l,e)=>f[e.id]?l+1:l,0)),D=C(()=>!g.value&&!!c.value&&m.value.length>0&&$.value===m.value.length),le=C(()=>g.value?"正在为你抽取本轮题目...":c.value?m.value.length?$.value?$.value<m.value.length?`已完成 ${$.value}/${m.value.length} 题，继续加油`:"全部题目已完成作答，可以提交":`本轮共有 ${m.value.length} 题，等待作答`:z.value||"当前难度暂无题目，试试重新抽题或切换难度":"选择难度后点击“开始本轮答题”，系统会随机抽题"),oe=C(()=>z.value||"当前难度暂无可用题目，试试重新抽题或切换到其他难度。"),ae=l=>({...l,options:[{label:l.option_a,value:"A"},{label:l.option_b,value:"B"},{label:l.option_c,value:"C"},{label:l.option_d,value:"D"}]}),re=l=>{L.value=l,v.value=null,N()},F=async()=>{g.value=!0,v.value=null,N();try{const{data:l}=await A.post("/quiz/start/",{level:L.value,limit:rt}),e=l?.questions??[];m.value=e.map(k=>ae(k)),c.value={id:l.session_id,level:l.level,total_questions:l.total_questions}}catch(l){console.error("Failed to start quiz session",l),c.value=null,m.value=[],z.value=l?.response?.data?.detail??"创建测验失败，请稍后重试"}finally{g.value=!1}},ne=async()=>{if(!(!D.value||!c.value)){S.value=!0;try{const l={level:c.value.level,session_id:c.value.id,answers:{...f}},{data:e}=await A.post("/quiz/submit/",l);v.value=e,N();try{await X()}catch(k){console.warn("Failed to refresh stats after submission",k)}}finally{S.value=!1}}},de=async()=>{try{await W()}catch(l){console.warn("Failed to load stats",l)}},P=async()=>{if(!Q.isAdmin)return;const{data:l}=await A.get("/quiz/admin/questions/",{params:{limit:5}});R.value=te(l).slice(0,5)},ue=async()=>{V.value=!0;try{await A.post("/quiz/admin/questions/",_),Object.assign(_,{text:"",level:"beginner",option_a:"",option_b:"",option_c:"",option_d:"",correct_answer:"A"}),P()}finally{V.value=!1}};return Se(()=>{F(),de(),P()}),(l,e)=>{const k=me,j=pe,E=ve,T=_e,x=ge,h=xe,H=be,ie=ye,I=fe,q=we,Z=ke;return d(),u("div",Be,[a(k,{title:"知识测验",description:"选择难度、回答问题并获得实时得分。"}),a(I,{class:"border border-border/80"},{default:r(()=>[a(T,null,{default:r(()=>[a(j,null,{default:r(()=>[...e[3]||(e[3]=[i("答题区域",-1)])]),_:1}),a(E,null,{default:r(()=>[...e[4]||(e[4]=[i("黑白分明的题目卡片帮助你聚焦内容。",-1)])]),_:1})]),_:1}),a(H,{class:"space-y-4"},{default:r(()=>[t("div",Qe,[(d(),u(y,null,w(Y,o=>a(h,{key:o.value,variant:s(L)===o.value?"default":"outline",class:"gap-2",onClick:b=>re(o.value)},{default:r(()=>[a(x,{name:o.icon,class:"h-4 w-4"},null,8,["name"]),i(" "+n(o.label),1)]),_:2},1032,["variant","onClick"])),64)),a(h,{variant:"secondary",size:"sm",class:"gap-2",disabled:s(g),onClick:F},{default:r(()=>[a(x,{name:s(c)?"lucide:refresh-cw":"lucide:play",class:"h-4 w-4"},null,8,["name"]),i(" "+n(s(c)?"重新抽题":"开始本轮答题"),1)]),_:1},8,["disabled"])]),s(c)?(d(),u("div",Ue,[a(x,{name:"lucide:timer",class:"h-4 w-4"}),t("div",null,[t("p",null,"当前会话："+n(U[s(c).level])+" · "+n(s(c).total_questions)+" 题",1),e[5]||(e[5]=t("p",{class:"text-xs"},"完成本轮后再提交答案，系统会刷新整体统计",-1))])])):B("",!0),s(g)?(d(),u("div",Le,[...e[6]||(e[6]=[t("div",{class:"h-24 rounded-md border border-dashed border-border/60"},null,-1),t("div",{class:"h-24 rounded-md border border-dashed border-border/60"},null,-1),t("div",{class:"h-24 rounded-md border border-dashed border-border/60"},null,-1)])])):(d(),u("div",Me,[s(m).length?(d(),u("div",Ne,[(d(!0),u(y,null,w(s(m),o=>(d(),u("div",{key:o.id,class:"rounded-xl border border-border/80 bg-card p-4"},[t("p",De,n(U[o.level]),1),t("p",Fe,n(o.text),1),t("div",je,[(d(!0),u(y,null,w(o.options,b=>(d(),u("label",{key:b.value,class:"flex cursor-pointer items-center justify-between rounded-lg border border-border/70 px-3 py-2 text-sm hover:bg-secondary"},[t("div",Ee,[O(t("input",{type:"radio",name:"question-"+o.id,value:b.value,"onUpdate:modelValue":ce=>s(f)[o.id]=ce,disabled:!s(c),class:"accent-black"},null,8,Te),[[Ve,s(f)[o.id]]]),t("span",null,n(b.label),1)]),t("span",He,n(b.value),1)]))),128))])]))),128))])):(d(),u("div",Ie,[a(x,{name:"lucide:sparkles",class:"h-6 w-6 text-muted-foreground"}),t("p",null,n(s(oe)),1),a(h,{size:"sm",variant:"outline",class:"gap-2",onClick:F},{default:r(()=>[a(x,{name:"lucide:refresh-cw",class:"h-4 w-4"}),e[7]||(e[7]=i(" 重新加载题目 ",-1))]),_:1}),s(Q).isAdmin?(d(),u("p",Oe," 作为管理员，你也可以在下方快速录入新题 ")):B("",!0)]))]))]),_:1}),a(ie,{class:"flex flex-col gap-3 border-t border-border/60 pt-4 md:flex-row md:items-center md:justify-between"},{default:r(()=>[t("p",Re,n(s(le)),1),t("div",Pe,[a(h,{class:"gap-2",disabled:s(S)||!s(D),variant:s(D)?"default":"secondary",onClick:ne},{default:r(()=>[a(x,{name:"lucide:send",class:"h-4 w-4"}),i(" "+n(s(S)?"提交中...":"提交答案"),1)]),_:1},8,["disabled","variant"]),s(v)?(d(),u("p",Ze," 得分 "+n(s(v).score)+"，正确 "+n(s(v).correct_answers)+"/"+n(s(v).total_questions),1)):B("",!0)])]),_:1})]),_:1}),a(I,{class:"border border-border/80"},{default:r(()=>[a(T,null,{default:r(()=>[a(j,null,{default:r(()=>[...e[8]||(e[8]=[i("测验统计",-1)])]),_:1}),a(E,null,{default:r(()=>[...e[9]||(e[9]=[i("了解你的进步趋势。",-1)])]),_:1})]),_:1}),a(H,{class:"grid gap-4 md:grid-cols-3"},{default:r(()=>[t("div",Ge,[e[10]||(e[10]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"总次数",-1)),t("p",Je,n(s(M).total_attempts),1)]),t("div",Ke,[e[11]||(e[11]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"平均分",-1)),t("p",We,n(s(M).average_score)+"%",1)]),t("div",Xe,[e[12]||(e[12]=t("p",{class:"text-xs uppercase tracking-widest text-muted-foreground"},"最佳成绩",-1)),t("p",Ye,n(s(M).best_score)+"%",1)])]),_:1})]),_:1}),s(Q).isAdmin?(d(),ze(I,{key:0,class:"border border-border/80"},{default:r(()=>[a(T,null,{default:r(()=>[a(j,null,{default:r(()=>[...e[13]||(e[13]=[i("管理员：快速扩展题库",-1)])]),_:1}),a(E,null,{default:r(()=>[...e[14]||(e[14]=[i("黑白控制台内即可录入新题。",-1)])]),_:1})]),_:1}),a(H,{class:"grid gap-6 md:grid-cols-2"},{default:r(()=>[t("form",{class:"space-y-3",onSubmit:$e(ue,["prevent"])},[t("div",null,[a(q,null,{default:r(()=>[...e[15]||(e[15]=[i("题目内容",-1)])]),_:1}),a(Z,{modelValue:s(_).text,"onUpdate:modelValue":e[0]||(e[0]=o=>s(_).text=o),required:"",placeholder:"描述一个诈骗场景"},null,8,["modelValue"])]),t("div",et,[(d(),u(y,null,w(["A","B","C","D"],o=>t("div",{key:o},[a(q,null,{default:r(()=>[i("选项 "+n(o),1)]),_:2},1024),a(Z,{modelValue:s(_)["option_"+o.toLowerCase()],"onUpdate:modelValue":b=>s(_)["option_"+o.toLowerCase()]=b,rows:"2",required:""},null,8,["modelValue","onUpdate:modelValue"])])),64))]),t("div",tt,[t("div",null,[a(q,null,{default:r(()=>[...e[16]||(e[16]=[i("难度",-1)])]),_:1}),O(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>s(_).level=o),class:"w-full rounded-md border border-border bg-background p-2 text-sm"},[...e[17]||(e[17]=[t("option",{value:"beginner"},"初级",-1),t("option",{value:"intermediate"},"中级",-1),t("option",{value:"advanced"},"高级",-1)])],512),[[J,s(_).level]])]),t("div",null,[a(q,null,{default:r(()=>[...e[18]||(e[18]=[i("正确答案",-1)])]),_:1}),O(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>s(_).correct_answer=o),class:"w-full rounded-md border border-border bg-background p-2 text-sm"},[(d(),u(y,null,w(["A","B","C","D"],o=>t("option",{key:o,value:o},n(o),9,st)),64))],512),[[J,s(_).correct_answer]])])]),a(h,{type:"submit",class:"w-full",disabled:s(V)},{default:r(()=>[i(n(s(V)?"保存中...":"新增题目"),1)]),_:1},8,["disabled"])],32),t("div",lt,[e[19]||(e[19]=t("p",{class:"text-sm text-muted-foreground"},"最近录入题目",-1)),(d(!0),u(y,null,w(s(R),o=>(d(),u("div",{key:o.id,class:"rounded-lg border border-border/70 p-3 text-sm"},[t("p",ot,n(o.text),1),t("p",at,"正确答案："+n(o.correct_answer)+" · 难度："+n(U[o.level]),1)]))),128))])]),_:1})]),_:1})):B("",!0)])}}});export{gt as default};
