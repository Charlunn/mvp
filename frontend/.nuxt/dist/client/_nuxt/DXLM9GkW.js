import{_ as ce}from"./pP1PrXx_.js";import{d as me,_ as fe,a as pe,b as _e,c as ve}from"./Bnx0PPvk.js";import{_ as be}from"./BgC2Tqll.js";import{_ as ge}from"./C3Ar38eF.js";import{c as oe,_ as xe}from"./CCRcQfJ_.js";import{_ as ye}from"./DzNSn88N.js";import{P as we,r as N,C as se,m as $,G as ke,g as H,Q as he,c,o as r,R as Q,i as ae,q as ne,H as G,v as _,j as Ve,k as $e,l as Ce,n as Se,b as t,w as l,a as s,t as d,d as n,J as Te,z as Pe,x as W,A as Ne,S as le,F as I,s as q,p as X,N as ze}from"./C4cmwJeW.js";import{i as je}from"./CGIFyomv.js";import{_ as Me}from"./BB_Ta-Np.js";import{u as Be}from"./BsCiWU7Q.js";import"./CTtaAHph.js";import"./hg5aJybS.js";function Ue(f){return JSON.parse(JSON.stringify(f))}function Ae(f,u,m,S={}){var y,b,g;const{clone:i=!1,passive:T=!1,eventName:z,deep:P=!1,defaultValue:J,shouldEmit:A}=S,x=we(),C=m||x?.emit||((y=x?.$emit)==null?void 0:y.bind(x))||((g=(b=x?.proxy)==null?void 0:b.$emit)==null?void 0:g.bind(x?.proxy));let M=z;M=M||`update:${u.toString()}`;const D=p=>i?typeof i=="function"?i(p):Ue(p):p,O=()=>je(f[u])?D(f[u]):J,R=p=>{A?A(p)&&C(M,p):C(M,p)};if(T){const p=O(),F=N(p);let B=!1;return se(()=>f[u],j=>{B||(B=!0,F.value=D(j),ke(()=>B=!1))}),se(F,j=>{!B&&(j!==f[u]||P)&&R(j)},{deep:P}),F}else return $({get(){return O()},set(p){R(p)}})}const De=["data-orientation"],Fe=H({__name:"Tabs",props:{defaultValue:{},modelValue:{},orientation:{},dir:{},activationMode:{}},emits:["update:modelValue"],setup(f,{emit:u}){const m=f,y=Ae(m,"modelValue",u,{passive:!0,defaultValue:m.defaultValue});return he("TabsContext",{modelValue:y,orientation:m.orientation??"horizontal",dir:m.dir??"ltr",activationMode:m.activationMode??"automatic"}),(b,g)=>(r(),c("div",{"data-orientation":f.orientation},[Q(b.$slots,"default")],8,De))}}),Le={key:0},Y=H({__name:"TabsContent",props:{value:{}},setup(f){const u=f,m=ae("TabsContext"),S=()=>m.modelValue.value===u.value;return(y,b)=>S()?(r(),c("div",Le,[Q(y.$slots,"default")])):ne("",!0)}}),Ie=H({__name:"TabsList",setup(f){return(u,m)=>(r(),c("div",{class:G(_(oe)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground"))},[Q(u.$slots,"default")],2))}}),qe=["data-state","disabled"],Z=H({__name:"TabsTrigger",props:{value:{},disabled:{type:Boolean}},setup(f){const u=f,m=ae("TabsContext"),S=()=>m.modelValue.value===u.value,y=()=>{u.disabled||(m.modelValue.value=u.value)};return(b,g)=>(r(),c("button",{"data-state":S()?"active":"inactive",disabled:f.disabled,class:G(_(oe)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm")),onClick:y},[Q(b.$slots,"default")],10,qe))}}),He={class:"space-y-6"},Je={class:"flex items-center gap-4"},Oe={class:"flex h-16 w-16 items-center justify-center rounded-full bg-background text-2xl font-semibold"},Re={class:"text-sm"},Ee={class:"relative mt-2 h-2 w-48 rounded-full bg-border"},Ge={class:"mt-1 text-xs text-muted-foreground"},Qe={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},Ke={class:"grid gap-4 md:grid-cols-2"},We={class:"grid gap-4 md:grid-cols-2"},Xe={class:"grid gap-4 md:grid-cols-2"},Ye={class:"space-y-2 rounded-lg border border-dashed border-border/60 p-3"},Ze={class:"flex items-center gap-2 text-xs"},et={class:"flex items-center gap-2 text-xs"},tt={class:"space-y-6"},st={class:"text-sm font-medium"},lt={class:"text-xs text-muted-foreground"},ot={class:"text-xs text-muted-foreground"},at={class:"mt-1 font-medium"},nt={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},it={class:"rounded-lg bg-background/70 p-3"},ut={class:"mt-1 text-xl font-semibold"},dt={class:"rounded-lg bg-background/70 p-3"},rt={class:"mt-1 text-xl font-semibold"},ct={class:"rounded-lg bg-background/70 p-3"},mt={class:"mt-1 text-xl font-semibold"},ft={class:"rounded-lg bg-background/70 p-3"},pt={class:"mt-1 text-xl font-semibold"},_t={key:0,class:"text-sm text-muted-foreground"},vt={key:1,class:"text-sm text-muted-foreground"},bt={key:2,class:"space-y-3"},gt={class:"min-w-0"},xt={class:"truncate font-medium"},yt={class:"text-xs text-muted-foreground"},wt={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},kt={class:"space-y-6"},ht={class:"grid gap-4 sm:grid-cols-2"},Vt={class:"mt-1 font-medium"},$t={class:"mt-1 font-medium capitalize"},Ct={class:"rounded-xl border border-border/70 bg-muted/40 p-3 text-center"},St={class:"mt-2 text-3xl font-semibold"},Tt={class:"rounded-xl border-dashed border-border/60 bg-background/80 p-3 text-muted-foreground"},Pt={class:"list-disc space-y-2 pl-5 text-sm text-muted-foreground"},Nt={class:"space-y-6"},zt={key:0,class:"text-sm text-muted-foreground"},jt={key:1,class:"space-y-4"},Mt={class:"font-medium"},Bt={class:"text-xs text-muted-foreground"},Qt=H({__name:"profile",setup(f){const u=Ve(),{$api:m}=$e(),{userStats:S,refreshUserStats:y}=Be(),b=N(!1),g=N(null),i=Ce({nickname:"",email:"",phone_number:"",profile_visibility:"public",show_email:!1,show_phone:!1}),T=N({posts_published:0,comments_written:0,post_likes_received:0,comment_likes_received:0}),z=N([]),P=N(!1),J=N(1),A=N(!1),x={quiz_attempts_count:0,average_score:0,best_score:0,last_attempt:null},C=$(()=>S.value??x),M=$(()=>(i.nickname||u.user?.nickname||u.user?.username||"U").trim().slice(0,2)),D=$(()=>u.isAdmin?"系统管理员":"实战学员"),O=$(()=>[{label:"当前身份",value:D.value,icon:"lucide:user-check"},{label:"测验段位",value:"初级训练",icon:"lucide:activity"},{label:"安全邮箱",value:i.email||"未填写",icon:"lucide:mail"}]),R=$(()=>g.value?.capabilityProfile??null),p=$(()=>{let a=40;return i.email&&(a+=20),i.phone_number&&(a+=20),C.value.quiz_attempts_count>0&&(a+=20),Math.min(a,100)}),F=$(()=>[{label:"绑定邮箱",hint:"用于找回密码与接收安全预警",done:!!i.email},{label:"绑定手机号",hint:"可启用二次验证与短信提醒",done:!!i.phone_number},{label:"完成测验",hint:"最近 30 天至少完成 1 次",done:C.value.quiz_attempts_count>0}]),B=$(()=>{const a=[];return(C.value.average_score||0)<70&&a.push("平均得分低于 70 分，建议复习课程。"),i.phone_number||a.push("尚未绑定手机号，建议绑定以提高安全性。"),C.value.last_attempt||a.push("缺少测验记录，建议完成一次测验。"),a.length||a.push("保持当前训练频率，挑战更高难度。"),a}),j=$(()=>{const a=[];return C.value.last_attempt&&a.push({title:"完成测验",time:new Date(C.value.last_attempt.created_at).toLocaleString("zh-CN"),status:"success"}),i.email&&a.push({title:"邮箱已绑定",time:"实时生效",status:"success"}),a}),ie=async()=>{try{const{data:a}=await m.get("/chat/latest-result/");a?.has_result&&(g.value=a.data)}catch(a){console.warn("Failed to fetch simulation result",a)}},ue=async()=>{try{const[a]=await Promise.all([m.get("/users/profile/"),y()]);Object.assign(i,a.data),T.value=a.data?.community_stats??T.value}catch(a){console.error("加载用户资料失败",a)}await Promise.all([ie(),ee()])},de=async()=>{b.value=!0;try{await m.put("/users/profile/",i),window.alert("资料已更新")}catch(a){console.error("保存资料失败",a),window.alert("保存失败，请稍后再试")}finally{b.value=!1}},ee=async(a=!1)=>{if(!u.user?.username)return;P.value=!0;const e=a?J.value+1:1;try{const{data:U}=await m.get("/community/posts/",{params:{author:u.user.username,page:e}}),v=U.results||[];a?z.value.push(...v):z.value=v,A.value=!!U.next,J.value=e}catch(U){console.warn("加载个人帖子失败",U)}finally{P.value=!1}},re=a=>new Date(a).toLocaleDateString("zh-CN");return Se(ue),(a,e)=>{const U=ce,v=pe,w=_e,k=fe,h=me,L=be,E=ge,K=xe,V=ve,te=ye;return r(),c("div",He,[t(U,{title:"用户主页",description:"掌握账号安全、训练表现与个人资料"}),t(h,{class:"border-border/70 bg-secondary/40"},{default:l(()=>[t(k,{class:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between"},{default:l(()=>[s("div",Je,[s("div",Oe,d(M.value),1),s("div",null,[t(v,{class:"text-2xl"},{default:l(()=>[n(d(i.nickname||_(u).user?.nickname||_(u).user?.username),1)]),_:1}),t(w,null,{default:l(()=>[n("澄源反诈 · "+d(D.value),1)]),_:1})])]),s("div",Re,[e[7]||(e[7]=s("p",{class:"text-muted-foreground"},"安全指数",-1)),s("div",Ee,[s("span",{class:"absolute inset-y-0 left-0 rounded-full bg-emerald-500 transition-all",style:Te({width:p.value+"%"})},null,4)]),s("p",Ge,d(p.value)+" / 100",1)])]),_:1})]),_:1}),t(_(Fe),{"default-value":"profile",class:"w-full"},{default:l(()=>[t(_(Ie),{class:"grid w-full grid-cols-3"},{default:l(()=>[t(_(Z),{value:"profile"},{default:l(()=>[...e[8]||(e[8]=[n("个人资料",-1)])]),_:1}),t(_(Z),{value:"community"},{default:l(()=>[...e[9]||(e[9]=[n("社区动态",-1)])]),_:1}),t(_(Z),{value:"training"},{default:l(()=>[...e[10]||(e[10]=[n("训练报告",-1)])]),_:1})]),_:1}),t(_(Y),{value:"profile",class:"mt-6"},{default:l(()=>[s("div",Qe,[t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[11]||(e[11]=[n("基本信息",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[12]||(e[12]=[n("更新昵称、联系方式，保持账号可恢复",-1)])]),_:1})]),_:1}),t(V,null,{default:l(()=>[s("form",{class:"space-y-4",onSubmit:Pe(de,["prevent"])},[s("div",Ke,[s("div",null,[t(L,{for:"nickname"},{default:l(()=>[...e[13]||(e[13]=[n("昵称",-1)])]),_:1}),t(E,{id:"nickname",modelValue:i.nickname,"onUpdate:modelValue":e[0]||(e[0]=o=>i.nickname=o)},null,8,["modelValue"])]),s("div",null,[t(L,{for:"username"},{default:l(()=>[...e[14]||(e[14]=[n("账号",-1)])]),_:1}),t(E,{id:"username",value:_(u).user?.username,disabled:""},null,8,["value"])])]),s("div",We,[s("div",null,[t(L,{for:"email"},{default:l(()=>[...e[15]||(e[15]=[n("邮箱",-1)])]),_:1}),t(E,{id:"email",modelValue:i.email,"onUpdate:modelValue":e[1]||(e[1]=o=>i.email=o),type:"email"},null,8,["modelValue"])]),s("div",null,[t(L,{for:"phone"},{default:l(()=>[...e[16]||(e[16]=[n("手机号",-1)])]),_:1}),t(E,{id:"phone",modelValue:i.phone_number,"onUpdate:modelValue":e[2]||(e[2]=o=>i.phone_number=o)},null,8,["modelValue"])])]),s("div",Xe,[s("div",null,[t(L,{for:"visibility"},{default:l(()=>[...e[17]||(e[17]=[n("主页可见性",-1)])]),_:1}),W(s("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>i.profile_visibility=o),class:"mt-1 w-full rounded-md border border-border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary"},[...e[18]||(e[18]=[s("option",{value:"public"},"公开",-1),s("option",{value:"private"},"私密",-1)])],512),[[Ne,i.profile_visibility]])]),s("div",Ye,[s("label",Ze,[W(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>i.show_email=o),type:"checkbox"},null,512),[[le,i.show_email]]),e[19]||(e[19]=n("公开邮箱",-1))]),s("label",et,[W(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>i.show_phone=o),type:"checkbox"},null,512),[[le,i.show_phone]]),e[20]||(e[20]=n("公开手机号",-1))])])]),t(K,{type:"submit",class:"w-full",disabled:b.value},{default:l(()=>[n(d(b.value?"保存中...":"保存资料"),1)]),_:1},8,["disabled"])],32)]),_:1})]),_:1}),s("div",tt,[t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[21]||(e[21]=[n("安全清单",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[22]||(e[22]=[n("完善关键资料提升安全指数",-1)])]),_:1})]),_:1}),t(V,{class:"space-y-3"},{default:l(()=>[(r(!0),c(I,null,q(F.value,o=>(r(),c("div",{key:o.label,class:"flex items-center justify-between rounded-lg border border-border/60 px-3 py-2"},[s("div",null,[s("p",st,d(o.label),1),s("p",lt,d(o.hint),1)]),t(te,{name:o.done?"lucide:check-circle":"lucide:circle",class:G(["h-5 w-5",o.done?"text-emerald-500":"text-muted-foreground"])},null,8,["name","class"])]))),128))]),_:1})]),_:1}),t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[23]||(e[23]=[n("账号状态",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[24]||(e[24]=[n("同步登录、活跃度与最近记录",-1)])]),_:1})]),_:1}),t(V,{class:"space-y-4"},{default:l(()=>[(r(!0),c(I,null,q(O.value,o=>(r(),c("div",{key:o.label,class:"flex items-start justify-between rounded-lg border border-border/60 px-3 py-2 text-sm"},[s("div",null,[s("p",ot,d(o.label),1),s("p",at,d(o.value),1)]),t(te,{name:o.icon,class:"h-4 w-4 text-muted-foreground"},null,8,["name"])]))),128))]),_:1})]),_:1})])])]),_:1}),t(_(Y),{value:"community",class:"mt-6"},{default:l(()=>[s("div",nt,[t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[25]||(e[25]=[n("社区活跃度",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[26]||(e[26]=[n("你的发帖与互动数据总览",-1)])]),_:1})]),_:1}),t(V,{class:"grid grid-cols-2 gap-4"},{default:l(()=>[s("div",it,[e[27]||(e[27]=s("p",{class:"text-xs text-muted-foreground"},"发布帖子",-1)),s("p",ut,d(T.value.posts_published),1)]),s("div",dt,[e[28]||(e[28]=s("p",{class:"text-xs text-muted-foreground"},"参与评论",-1)),s("p",rt,d(T.value.comments_written),1)]),s("div",ct,[e[29]||(e[29]=s("p",{class:"text-xs text-muted-foreground"},"帖子获赞",-1)),s("p",mt,d(T.value.post_likes_received),1)]),s("div",ft,[e[30]||(e[30]=s("p",{class:"text-xs text-muted-foreground"},"评论获赞",-1)),s("p",pt,d(T.value.comment_likes_received),1)])]),_:1})]),_:1}),t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[31]||(e[31]=[n("我的帖子",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[32]||(e[32]=[n("已发布的全部帖子列表",-1)])]),_:1})]),_:1}),t(V,null,{default:l(()=>[P.value&&!z.value.length?(r(),c("div",_t,"加载中…")):z.value.length?(r(),c("div",bt,[(r(!0),c(I,null,q(z.value,o=>(r(),c("div",{key:o.id,class:"flex items-center justify-between gap-2 rounded-lg border border-border/70 p-3"},[s("div",gt,[s("p",xt,d(o.title),1),s("p",yt,d(o.community_detail?.name||"社区")+" · "+d(re(o.created_at)),1)]),t(K,{variant:"ghost",size:"sm",onClick:Ut=>("navigateTo"in a?a.navigateTo:_(ze))(`/community/posts/${o.id}`)},{default:l(()=>[...e[33]||(e[33]=[n("查看",-1)])]),_:1},8,["onClick"])]))),128)),A.value?(r(),X(K,{key:0,class:"w-full",variant:"outline",disabled:P.value,onClick:e[6]||(e[6]=o=>ee(!0))},{default:l(()=>[n(d(P.value?"加载中...":"加载更多帖子"),1)]),_:1},8,["disabled"])):ne("",!0)])):(r(),c("div",vt,"暂未发布任何帖子。"))]),_:1})]),_:1})])]),_:1}),t(_(Y),{value:"training",class:"mt-6"},{default:l(()=>[s("div",wt,[s("div",kt,[t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[34]||(e[34]=[n("AI 模拟总结",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[35]||(e[35]=[n("最近一次对话式演练表现",-1)])]),_:1})]),_:1}),g.value?(r(),X(V,{key:0,class:"space-y-3 text-sm"},{default:l(()=>[s("div",ht,[s("div",null,[e[36]||(e[36]=s("p",{class:"text-xs uppercase text-muted-foreground"},"场景",-1)),s("p",Vt,d(g.value.scenarioType),1)]),s("div",null,[e[37]||(e[37]=s("p",{class:"text-xs uppercase text-muted-foreground"},"难度",-1)),s("p",$t,d(g.value.difficulty),1)])]),s("div",Ct,[e[38]||(e[38]=s("p",{class:"text-xs uppercase text-muted-foreground"},"最终得分",-1)),s("p",St,d(g.value.finalScore),1)]),s("p",Tt,d(g.value.performanceAnalysis),1)]),_:1})):(r(),X(V,{key:1},{default:l(()=>[...e[39]||(e[39]=[s("p",{class:"text-muted-foreground"},"暂无模拟记录。",-1)])]),_:1}))]),_:1}),t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[40]||(e[40]=[n("成长建议",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[41]||(e[41]=[n("基于当前表现生成训练提示",-1)])]),_:1})]),_:1}),t(V,null,{default:l(()=>[s("ul",Pt,[(r(!0),c(I,null,q(B.value,o=>(r(),c("li",{key:o},d(o),1))),128))])]),_:1})]),_:1})]),s("div",Nt,[t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[42]||(e[42]=[n("能力雷达图",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[43]||(e[43]=[n("多维度评估反诈能力",-1)])]),_:1})]),_:1}),t(V,{class:"p-4"},{default:l(()=>[t(Me,{profile:R.value,height:"240px"},null,8,["profile"])]),_:1})]),_:1}),t(h,{class:"border-border/70"},{default:l(()=>[t(k,null,{default:l(()=>[t(v,null,{default:l(()=>[...e[44]||(e[44]=[n("账号活动记录",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[45]||(e[45]=[n("了解安全动作与训练轨迹",-1)])]),_:1})]),_:1}),t(V,null,{default:l(()=>[j.value.length?(r(),c("ul",jt,[(r(!0),c(I,null,q(j.value,o=>(r(),c("li",{key:o.title+o.time,class:"relative pl-6 text-sm"},[s("span",{class:G(["absolute left-0 top-1 h-2 w-2 rounded-full",o.status==="success"?"bg-emerald-500":"bg-muted-foreground"])},null,2),s("p",Mt,d(o.title),1),s("p",Bt,d(o.time),1)]))),128))])):(r(),c("div",zt,"暂无活动记录"))]),_:1})]),_:1})])])]),_:1})]),_:1})])}}});export{Qt as default};
