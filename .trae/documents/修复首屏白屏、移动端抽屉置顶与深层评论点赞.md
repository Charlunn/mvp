## 问题与根因
- 首屏白屏：`frontend/middleware/auth.global.ts:3` 在服务端直接 `return`，SSR阶段不执行鉴权与重定向，导致首屏输出受限页面的“空态”，客户端水合后才修正为登录页。
- 移动端抽屉未置顶：抽屉容器在 `frontend/components/layout/AppShell.vue:85–125` 使用普通流定位，未 `fixed` 到视口顶层，且 `z-index` 不足，滚动到页面底部时抽屉在页面顶部展开、不可见。
- 深层评论不可点赞：`frontend/components/community/CommentThread.vue:46` 的装饰性绝对元素（竖线）与折叠控制按钮可能与内容产生叠层或点击命中问题，深层嵌套下阻挡了点赞按钮的指针事件。

## 修改方案
1. SSR鉴权重定向（消除白屏）
- 文件：`frontend/middleware/auth.global.ts`
- 方案：移除服务端早退，让 SSR 也执行 `requiresAuth` 判断，并使用 302 服务端重定向。
- 逻辑要点：
  - 未登录访问受保护页 → `return navigateTo('/login', { redirectCode: 302 })`
  - 已登录访问登录页 → `return navigateTo('/', { redirectCode: 302 })`
  - 客户端分支保留现状；`fetchProfile` 放在客户端执行，服务端仅负责重定向判定，避免阻塞SSR。

2. 移动端抽屉置顶与遮罩
- 文件：`frontend/components/layout/AppShell.vue`
- 修改点：
  - 将抽屉容器改为 `fixed inset-x-0 top-0 z-50 max-h-screen overflow-y-auto bg-background border-b px-4 py-4`，始终贴合视口顶部并在内容之上。
  - 新增半透明遮罩：`fixed inset-0 z-40 bg-black/20`，点击遮罩关闭抽屉，并在抽屉打开时为 `document.body` 添加 `overflow-hidden`（可选）。
  - 保持现有 `header` 的 `sticky top-0 z-20`，确保层级关系：遮罩(z-40) < 抽屉(z-50)。
- 受影响代码段：`header` 在 `AppShell.vue:65–84`，抽屉在 `AppShell.vue:85–125`。

3. 深层评论点赞可点击
- 文件：`frontend/components/community/CommentThread.vue`
- 修改点：
  - 为竖线装饰元素添加 `pointer-events-none` 与较低层级（如不设 `z-index` 或 `z-0`）：`CommentThread.vue:46`，避免阻挡交互。
  - 确保折叠按钮仅覆盖左侧小区域（保持 `w-4`），并不跨越内容层；为内容区设置较高层级（如 `relative z-10`），点赞按钮不被覆盖：`CommentThread.vue:2–7, 14–17, 45–64`。
  - 保留递归 `:on-like="onLike"` 透传；父页面 `frontend/pages/community/posts/[id].vue:278–286` 已在点赞后 `fetchPost()`，也可后续优化为本地就地更新以减少整页刷新。

## 回归验证
- 未登录直接访问受保护页（如 `frontend/pages/index.vue:148–151` 标注 `requiresAuth: true`）时，SSR返回登录页，无白屏与闪烁；登录后访问 `/login` SSR 302 到 `/`。
- 移动端在页面底部点击“菜单”，抽屉与遮罩以置顶覆盖出现；遮罩点击可关闭，滚动行为按预期（可选禁用）。
- 在帖子详情中（`frontend/pages/community/posts/[id].vue:126–139`）深层嵌套评论的每个点赞按钮可正常点击，`like_count` 与 `is_liked` 正确刷新。

## 风险与兼容
- SSR分支依赖Cookie：`frontend/stores/auth.ts:32–36` 使用 `useCookie`，服务端可读，风险低。
- 抽屉改为 `fixed` 带来层级与滚动管理：通过遮罩与 `z-index` 明确层级，避免遮挡；保留 `sticky` 头部不受影响。
- 评论交互改动仅涉及装饰元素的指针事件与层级，不影响数据逻辑。

## 实施与交付
- 我将按上述步骤修改三处文件，并进行本地验证（含移动端视图）。请确认方案，确认后我会开始实施并回传具体改动。